patternCentroid<-function(D,width=32,height=16,template){
K = dim(as.matrix(D))[2];
ind = which(template[,,1]==1);

Dtemp = matrix(0,nrow = width*height,ncol = K);
Dtemp[ind,] = D;
vertLoc = horiLoc = rep(0,K);
for (i in 1:K){
    dtemp = Dtemp[,i];
    ptemp = matrix(dtemp,nrow = height,ncol = width);
    prob = colSums(ptemp);
    prob = prob/sum(prob);
    horiLoc[i] = sum(prob*(1:width));

    prob = colSums(ptemp);
    prob = prob/sum(prob);
    horiLoc[i] = sum(prob*(1:width));

}
idx = sort.int(horiLoc,index.return = TRUE)$ix;
return(idx);




}